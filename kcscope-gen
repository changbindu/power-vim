# generate cscope database for linux kernel

base_dirs="arch/x86 init ipc kernel lib mm samples security tools virt include
           drivers/base drivers/cpufreq drivers/cpuidle drivers/devfreq drivers/dma
           drivers/dma-buf drivers/idle drivers/irqchip drivers/of drivers/pci
           drivers/perf drivers/char drivers/platform drivers/power drivers/reset
           drivers/vfio drivers/virt drivers/virtio"
all_dirs="$base_dirs $*"

for d in $all_dirs	
do
  echo "$d"
done

echo 'generating database for kernel and old one will be deleted...'
find $all_dirs \( \( -iname "*.c" -o -iname "*.cc" -o -iname "*.h" \) -and \( -not -type l \) \) -print > cscope.files
# process links
find $all_dirs \( \( -iname "*.c" -o -iname "*.cc" -o -iname "*.h" \) -and -type l \) -exec realpath --relative-to=. "{}" \;  >> cscope.files
cscope -bkq -I include/ -i cscope.files
echo 'done'
